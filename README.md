**WIP**
Porting this entire thing to ANSI C
